---
title: "Climate changes project"
author: "Paul-Markus Orav and Withee Poositasai"
date: "`r Sys.Date()`"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

library(tidyverse)
library(ggpubr)
```

# 1. Introduction

Global warming has been a urgent topic for the current century. There are consistent new regulations and directives which aim to reduce the co2 emissions in hopes of slowing down the increasing of land temperatures. For that purpose, the researchers have decided to analyse two datasets a uncover any relationships which may exist. 

## 1.1 Research Questions

The researchers have proposed 2 research questions to direct the analysis of such large data:

### RQ1: What is the correlation between global CO2 emissions and global land warming from 1913-2012?

The researchers hypothesise that there is a positive correlation between CO2 emissions and global land warming, therefore an increase in CO2 emissions results in increased land temperatures.

The null hypothesis is that there is no correlation between CO2 emissions and land temperature and that they are independant of each other. 

### RQ2: Who are the evil emitters and who are the unlucky receivers?

  2.1. Does the country with highest CO2 emission also get affected the most by global land warming?
  
  2.2. Does some other country get affected by another countries high CO2 emissions?

# 2. Datasets and exploratory analysis

## 2.1 Global land temperature data by country

The researchers are using a dataset which contains data regarding the Global land temperature by country. 
Source: <https://data.world/data-society/global-climate-change-data>

```{r}
temperature <- read_csv('GlobalLandTemperatures_GlobalLandTemperaturesByCountry.csv', show_col_types = FALSE)
glimpse(temperature)
```

Need to explain more about each columns

Check the datetime column. The newest record is in 2013-09-01. The dataset contains record of every 1st of the month.

```{r}
sort(unique(temperature$dt), decreasing = TRUE)[1:10]
```

```{r}
temperature %>%
  filter(between(dt, as.Date('2002-01-01'), as.Date('2012-12-31'))) %>%
  filter(Country %in% c('Estonia', 'Thailand', 'Africa', 'Australia', 'United States', 'China', 'India')) %>%
  ggplot(aes(x=dt, y=AverageTemperature, color=Country)) +
    geom_line() +
    labs(title = 'Monthly average temperature from 2002-2012')
```


## 2.2 Global CO2 emission by country

Source: <https://ourworldindata.org/co2-dataset-sources>

```{r}
co2emission <- read_csv('annual-co2-emissions-per-country.csv', show_col_types = FALSE)
glimpse(co2emission)
```

Need to explain more about each columns

Check the year column. The dataset contain annual data. The newest record is in 2021

```{r}
sort(unique(co2emission$Year), decreasing = TRUE)[1:10]
```

# 3. Data cleaning and transformation

## 3.1 Annual temperature by country

Calculate annual average temperature from 1913 - 2012 and drop NAs row

```{r}
annualTemperature <- temperature %>%
  drop_na %>%
  mutate(Year = as.integer(format(dt, '%Y'))) %>%
  select(-dt) %>%
  filter(between(Year, 1913, 2012)) %>%
  group_by(Country, Year) %>%
  summarise(AverageTemperature = mean(AverageTemperature), AverageTemperatureUncertainty = mean(AverageTemperatureUncertainty))

annualTemperature
```

```{r}
annualTemperature %>%
  filter(Country %in% c('Estonia', 'Thailand', 'Africa', 'Australia', 'United States', 'China', 'India')) %>%
  ggplot(aes(x=Year, y=AverageTemperature, color=Country)) +
    geom_point(size = 0.8, alpha = 0.3) +
    geom_smooth(method='lm') +
    labs(title = 'Annual average temperature from 1913 - 2012')
```

```{r Temperature Per Country}
AvgTemp <- annualTemperature %>%
  filter(Country %in% c('Estonia', 'Thailand', 'Africa', 'Australia', 'United States', 'China', 'India'))

AvgTempEstonia <- annualTemperature %>%
  filter(Country %in% c('Estonia'))

AvgTempThailand <- annualTemperature %>%
  filter(Country %in% c('Thailand'))

AvgTempAfrica <- annualTemperature %>%
  filter(Country %in% c('Africa'))

AvgTempAustralia <- annualTemperature %>%
  filter(Country %in% c('Australia'))

AvgTempUS <- annualTemperature %>%
  filter(Country %in% c('United States'))

AvgTempChina <- annualTemperature %>%
  filter(Country %in% c('China'))

AvgTempIndia <- annualTemperature %>%
  filter(Country %in% c('India'))
```

## 3.2 Co2 emission by country

Filter only record from 1913-2012

```{r}
selectedCo2Emission <- co2emission %>%
  filter(between(Year, 1913, 2012))

selectedCo2Emission
```

```{r}
selectedCo2Emission %>%
  filter(Entity %in% c('Estonia', 'Thailand', 'Africa', 'Australia', 'United States', 'China', 'India')) %>%
  ggplot(aes(x=Year, y=`Annual CO2 emissions`, color=Entity)) +
    geom_line() +
    labs(title = 'Annual CO2 emissions from 1913-2012')
```

```{r Co2 Per Country}

Avgco2 <- selectedCo2Emission %>%
  filter(Entity %in% c('Estonia', 'Thailand', 'Africa', 'Australia', 'United States', 'China', 'India'))

Avgco2Estonia <- selectedCo2Emission %>%
  filter(Entity %in% c('Estonia'))

Avgco2Thailand <- selectedCo2Emission %>%
  filter(Entity %in% c('Thailand'))

Avgco2Africa <- selectedCo2Emission %>%
  filter(Entity %in% c('Africa'))

Avgco2Australia <- selectedCo2Emission %>%
  filter(Entity %in% c('Australia'))

Avgco2US <- selectedCo2Emission %>%
  filter(Entity %in% c('United States'))

Avgco2China <- selectedCo2Emission %>%
  filter(Entity %in% c('China'))

Avgco2India <- selectedCo2Emission %>%
  filter(Entity %in% c('India'))

```

# Research Question 1 
## Correlation Analysis

To answer the first research question, the researchers conducted correlation analysis between CO2 emission and land temperature in the following locations: Estonia, Thailand, Africa, Australia, United States, China, and India. 

Here I have run a preliminary correlation test on all countries together, however I don't think that makes too much sense. However perhaps I just cannot read it properly at the moment. 

```{r All Countries}
cor.test(AvgTemp$AverageTemperature, Avgco2$`Annual CO2 emissions`, method = c("pearson", "kendall", "spearman"))

```

```{r Estonia}

cor.test(AvgTempEstonia$AverageTemperature, Avgco2Estonia$`Annual CO2 emissions`, method = c("pearson", "kendall", "spearman"))
```

```{r Thailand}

cor.test(AvgTempThailand$AverageTemperature, Avgco2Thailand$`Annual CO2 emissions`, method = c("pearson", "kendall", "spearman"))
```

```{r Africa}

cor.test(AvgTempAfrica$AverageTemperature, Avgco2Africa$`Annual CO2 emissions`, method = c("pearson", "kendall", "spearman"))

```

```{r Australia}

cor.test(AvgTempAustralia$AverageTemperature, Avgco2Australia$`Annual CO2 emissions`, method = c("pearson", "kendall", "spearman"))

```

```{r United States}

cor.test(AvgTempUS$AverageTemperature, Avgco2US$`Annual CO2 emissions`, method = c("pearson", "kendall", "spearman"))

```

```{r China}

cor.test(AvgTempChina$AverageTemperature, Avgco2China$`Annual CO2 emissions`, method = c("pearson", "kendall", "spearman"))

```

```{r India}

cor.test(AvgTempIndia$AverageTemperature, Avgco2India$`Annual CO2 emissions`, method = c("pearson", "kendall", "spearman"))

```

## Results

For this report, the researchers have decided to look at the CO2 emissions and land temperatures of Estonia, Thailand, Africa, Australia, United states, China and India. All of these locations have a positive correlation between CO2 emissions and land temperatures, however some places with a higher coefficient than others. 

Estonia is the only country which seems to have no significant (p=0.21) result for the correlation and also with a smaller coefficient (r(98)=.13) than other places. All other locations had highly significant (p<.0001) correlation results. Africa showed the highest CO2 emission and land temperature correlation with a result of r(98)=0.80. After Africa, in descending order, there is Australia (r(98)=0.69), China (r(98)=0.68), India (r(98)=0.66), Thailand (r(98)=0.55), and United States (r(98)=0.47). 


# RQ2

Create a new dataframe for predicted average temperature from linear regression model by each country in 1913 and 2012

```{r}
countryList = unique(annualTemperature$Country)
yearDf = data.frame(Year = c(1913, 2012))

predictedAverageTemperature = tibble()

for (country in countryList) {
  AverageTemperature = predict(
                lm(AverageTemperature~Year, filter(annualTemperature, Country == country)),
                yearDf) %>%
              as.double
  
  predictedAverageTemperature <- bind_rows(
    predictedAverageTemperature,
    tibble(
      Country = rep(country, times = length(yearDf)),
      Year =  yearDf$Year,
      AverageTemperature,
    )
  )
}

predictedAverageTemperature
```

```{r}
predictedAverageTemperature %>%
  filter(Country %in% c('Estonia', 'Thailand', 'Africa', 'Australia', 'United States', 'China', 'India')) %>%
  ggplot(aes(x=Year, y=AverageTemperature, color=Country)) +
    geom_line() +
    labs(title = 'Annual average temperature from 1913 - 2012 using linear regression model')
```

# Discussion
